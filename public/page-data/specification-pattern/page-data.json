{"componentChunkName":"component---src-templates-blog-post-js","path":"/specification-pattern/","result":{"data":{"site":{"siteMetadata":{"title":"Chris Hibler"}},"markdownRemark":{"id":"526f5e75-189f-594c-a343-51948e5b4e1e","excerpt":"Mastering the Specification Pattern Software development often requires crafting solutions that are both robust and maintainable. One way to achieve this is by…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/825d5b9eb6081ce8faa69e1fec5526ed/72e01/specification-pattern.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAQACA//EABUBAQEAAAAAAAAAAAAAAAAAAAEE/9oADAMBAAIQAxAAAAHm5K4mJP/EABYQAAMAAAAAAAAAAAAAAAAAAAAgIf/aAAgBAQABBQIi/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAXEAADAQAAAAAAAAAAAAAAAAAAESBR/9oACAEBAAE/IRan/9oADAMBAAIAAwAAABAY3//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EIf/xAAZEAEAAgMAAAAAAAAAAAAAAAABABEgIeH/2gAIAQEAAT8QQ7HfWP8A/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Specification Pattern\"\n        title=\"\"\n        src=\"/static/825d5b9eb6081ce8faa69e1fec5526ed/828fb/specification-pattern.jpg\"\n        srcset=\"/static/825d5b9eb6081ce8faa69e1fec5526ed/ff44c/specification-pattern.jpg 158w,\n/static/825d5b9eb6081ce8faa69e1fec5526ed/a6688/specification-pattern.jpg 315w,\n/static/825d5b9eb6081ce8faa69e1fec5526ed/828fb/specification-pattern.jpg 630w,\n/static/825d5b9eb6081ce8faa69e1fec5526ed/0ede0/specification-pattern.jpg 945w,\n/static/825d5b9eb6081ce8faa69e1fec5526ed/72e01/specification-pattern.jpg 1024w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Mastering the Specification Pattern</h2>\n<p>Software development often requires crafting solutions that are both robust and maintainable. One way to achieve this is by adhering to established design patterns. The Specification Pattern is a lesser-known but powerful tool for encapsulating business logic and ensuring cleaner code. In this article, we’ll explore how to implement the Specification Pattern using the Ardalis.Specification package in a .NET project.</p>\n<h2>What is the Specification Pattern?</h2>\n<p>The Specification Pattern is a design pattern used to encapsulate business rules. It allows you to combine and reuse rules without tightly coupling them to your entities or services. Instead of scattering query logic throughout your codebase, specifications centralize this logic into reusable and composable classes.</p>\n<h2>Why Use Ardalis.Specification?</h2>\n<p>The <code class=\"language-text\">Ardalis.Specification</code> library provides a robust implementation of the Specification Pattern in .NET. It simplifies querying and filtering, especially in conjunction with repositories. By using this package, you can:</p>\n<ul>\n<li>Centralize business logic: Keep query specifications in a single place.</li>\n<li>Promote reusability: Reuse specifications across multiple services or repositories.</li>\n<li>Enhance testability: Specifications are easier to test than inline LINQ queries.</li>\n</ul>\n<h1>Getting Started</h1>\n<p>To follow along, ensure you have:</p>\n<ul>\n<li>A .NET 6+ project.</li>\n<li>A basic understanding of Entity Framework Core (EF Core).</li>\n<li>The Ardalis.Specification package installed.</li>\n</ul>\n<h1>Install Ardalis.Specification</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dotnet <span class=\"token function\">add</span> package Ardalis.Specification</code></pre></div>\n<h2>Setting Up the Project</h2>\n<p>Assume you have an e-commerce application with an Order entity:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Order</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">int</span></span> Id <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">DateTime</span> OrderDate <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> CustomerName <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">decimal</span></span> TotalAmount <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> IsShipped <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, let’s implement the Specification Pattern.</p>\n<h2>Defining Specifications</h2>\n<p>A specification encapsulates the filtering logic. For example, suppose you need to fetch all unshipped orders for a specific customer:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Ardalis<span class=\"token punctuation\">.</span>Specification</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UnshippedOrdersSpecification</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Specification<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span></span></span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">UnshippedOrdersSpecification</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> customerName<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">.</span><span class=\"token function\">Where</span><span class=\"token punctuation\">(</span>o <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>o<span class=\"token punctuation\">.</span>IsShipped <span class=\"token operator\">&amp;&amp;</span> o<span class=\"token punctuation\">.</span>CustomerName <span class=\"token operator\">==</span> customerName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here, we define a class inheriting from Specification<T> and use the Query property to specify filtering logic.</p>\n<h2>Integrating with Repositories</h2>\n<p>Repositories provide an abstraction over data access. Here’s how you can integrate specifications:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Ardalis<span class=\"token punctuation\">.</span>Specification<span class=\"token punctuation\">.</span>EntityFrameworkCore</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IRepository<span class=\"token punctuation\">&lt;</span>T<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">IRepositoryBase<span class=\"token punctuation\">&lt;</span>T<span class=\"token punctuation\">></span></span></span> <span class=\"token keyword\">where</span> <span class=\"token class-name\">T</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token keyword\">class</span></span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Repository<span class=\"token punctuation\">&lt;</span>T<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">RepositoryBase<span class=\"token punctuation\">&lt;</span>T<span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IRepository<span class=\"token punctuation\">&lt;</span>T<span class=\"token punctuation\">></span></span></span> <span class=\"token keyword\">where</span> <span class=\"token class-name\">T</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token keyword\">class</span></span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token function\">Repository</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AppDbContext</span> dbContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">base</span><span class=\"token punctuation\">(</span>dbContext<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The `RepositoryBase<T> from Ardalis.Specification.EntityFrameworkCore provides built-in support for specifications.</p>\n<p>Using Specifications</p>\n<p>With the repository and specifications in place, you can query data:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">IRepository<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span></span> _orderRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">OrderService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IRepository<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span></span> orderRepository<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        _orderRepository <span class=\"token operator\">=</span> orderRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token return-type class-name\">Task<span class=\"token punctuation\">&lt;</span>List<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">GetUnshippedOrdersForCustomerAsync</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> customerName<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> spec <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UnshippedOrdersSpecification</span><span class=\"token punctuation\">(</span>customerName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> _orderRepository<span class=\"token punctuation\">.</span><span class=\"token function\">ListAsync</span><span class=\"token punctuation\">(</span>spec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here, we use the <code class=\"language-text\">ListAsync</code> method to fetch data based on the specification.</p>\n<h2>Testing Specifications</h2>\n<p>Specifications are simple to test because they are isolated. Use an in-memory database or mock repository:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Fact</span></span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">UnshippedOrdersSpecification_ReturnsCorrectResults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Arrange</span>\n  <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> orders <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">List<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Order</span> <span class=\"token punctuation\">{</span> Id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> CustomerName <span class=\"token operator\">=</span> <span class=\"token string\">\"Alice\"</span><span class=\"token punctuation\">,</span> IsShipped <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Order</span> <span class=\"token punctuation\">{</span> Id <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> CustomerName <span class=\"token operator\">=</span> <span class=\"token string\">\"Alice\"</span><span class=\"token punctuation\">,</span> IsShipped <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Order</span> <span class=\"token punctuation\">{</span> Id <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> CustomerName <span class=\"token operator\">=</span> <span class=\"token string\">\"Bob\"</span><span class=\"token punctuation\">,</span> IsShipped <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">AsQueryable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> spec <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UnshippedOrdersSpecification</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Alice\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Act</span>\n  <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> result <span class=\"token operator\">=</span> orders<span class=\"token punctuation\">.</span><span class=\"token function\">Where</span><span class=\"token punctuation\">(</span>spec<span class=\"token punctuation\">.</span>WhereExpressions<span class=\"token punctuation\">.</span><span class=\"token function\">First</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Compile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Assert</span>\n  Assert<span class=\"token punctuation\">.</span><span class=\"token function\">Single</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Assert<span class=\"token punctuation\">.</span><span class=\"token function\">Equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">First</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Conclusion</h2>\n<p>The Specification Pattern, when implemented using Ardalis.Specification, promotes clean architecture and reusable query logic. By encapsulating business rules in specifications, your application becomes more maintainable, testable, and robust. Whether you’re building a small project or a complex enterprise solution, this pattern is a valuable addition to your toolkit.</p>","frontmatter":{"title":"Mastering the Specification Pattern","date":"January 02, 2025","description":"Using the specification pattern with Ardalis.Specification - Chris Hibler"}},"previous":null,"next":{"fields":{"slug":"/asp-enable-cors/"},"frontmatter":{"title":"Enable CORS in ASP.NET Core (WebAPI)"}}},"pageContext":{"id":"526f5e75-189f-594c-a343-51948e5b4e1e","previousPostId":null,"nextPostId":"c8f0b1f8-3ebd-5daf-b331-953c17b2b141"}},"staticQueryHashes":["1596207573","2841359383","3274528899"],"slicesMap":{}}